<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="../site.webmanifest">
<link rel="icon" type="image/png" sizes="192x192" href="../iconos/ictusgps.png">
<link rel="apple-touch-icon" sizes="180x180" href="../iconos/ictusgps.png">
<link rel="shortcut icon" href="../iconos/ictusgps.png">
<meta name="theme-color" content="#0f3d83">
<title>Escala RoPE — Risk of Paradoxical Embolism</title>

<style>
:root{
  --bg:#f8fafc; --ink:#0f172a; --borde:#e5e7eb;
  --ok:#166534; --ok-bg:#e9fce7; --ok-ring:#bbf7d0;
  --mid:#92400e; --mid-bg:#fff7ed; --mid-ring:#fed7aa;
  --bad:#991b1b; --bad-bg:#fef2f2; --bad-ring:#fecaca;
  --accent:#2563eb; --accent-light:#dbeafe;
}

/* ===== CABECERA ===== */
.appbar {
  position: sticky; top: 0; z-index: 1000;
  background: #0f3d83; color: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.appbar-inner {
  max-width: 980px; margin: 0 auto;
  padding: 4px 16px;
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px;
}
.left-group { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.appbar h1 { margin:0; font-size:22px; font-weight:800; color:#fff; }
.pill {
  display:inline-flex; align-items:center; justify-content:center;
  min-width:38px; height:32px; padding:6px 10px;
  border-radius:999px; font-size:13px; font-weight:700;
  border:1px solid transparent; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.pill-init {background:#dbeafe; color:#1e3a8a; border-color:#bfdbfe;}
.pill-ok   {background:#dcfce7; color:#065f46; border-color:#86efac;}
.pill-warn {background:#fef3c7; color:#92400e; border-color:#fde68a;}
.pill-bad  {background:#fee2e2; color:#991b1b; border-color:#fecaca;}
.btn {
  display:inline-flex;align-items:center;justify-content:center;
  height:32px;padding:0 14px;border-radius:10px;
  text-decoration:none;border:1px solid rgba(127,179,255,.35);
  background:#1c60c3;color:white;font-size:0.9rem;font-weight:700;
  transition:background .2s,border-color .2s;
  overflow:hidden;text-overflow:ellipsis;
  transform: translateY(-8px);
}
.btn:hover{background:#0C00FF;}

/* ===== CUERPO ===== */
body{margin:0;background:var(--bg);color:var(--ink);font-family:Verdana, Geneva, sans-serif;}
.wrap{max-width:980px;margin:16px auto 48px;padding:0 16px;}
.panel{background:#fff;border:1px solid var(--borde);border-radius:16px;padding:16px;box-shadow:0 2px 10px rgba(15,23,42,.06);}
label{font-weight:900;color:#0b1f44;margin-top:8px;display:block;}
select{width:100%;padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;font-size:14px;}
select:focus{outline:none;box-shadow:0 0 0 3px #dbeafe;}
.note{color:#64748b;font-size:12px;margin-top:8px;}
.grid{display:grid;gap:10px;}
@media(min-width:720px){.grid{grid-template-columns:1fr 1fr;}}

/* ===== CHECKS ===== */
.check{display:flex;align-items:center;gap:8px;margin:6px 0;color:#0b1f44;font-weight:700;}
.check input{transform:scale(1.1);}

/* ===== RESULTADOS ===== */
.kpi{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;}
.box{border:1.5px dashed #c7dbff;border-radius:14px;padding:14px;background:#f8fbff;text-align:center;}
.ttl{font-size:14px;color:#334155;font-weight:800;margin-bottom:2px;}
.val{font-size:24px;font-weight:900;color:#0b2c5f;}
.mini{font-size:12px;color:#64748b;margin-top:4px;}
.ok{background:var(--ok-bg);border-color:var(--ok-ring);} 
.warn{background:var(--mid-bg);border-color:var(--mid-ring);} 
.bad{background:var(--bad-bg);border-color:var(--bad-ring);} 
.ok .val{color:var(--ok);} .warn .val{color:var(--mid);} .bad .val{color:var(--bad);}

/* ===== BOTONES ===== */
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px;}
.btn-action{
  flex:1 1 48%;
  border:none;border-radius:10px;padding:12px;
  font-size:15px;font-weight:700;cursor:pointer;
  transition:background .2s;
}
.btn-clear {background:#fff; color:#0b2c5f; border:1px solid #2563eb;}
.btn-clear:hover {background:#eff6ff;}
.btn-copy {background:#fff; color:#0f3d83; border:1px solid #2563eb;}
.btn-copy:hover {background:#eff6ff;}
.btn-copy.copiado{background:#0f3d83!important;color:#fff!important;}

/* ===== RESUMEN ===== */
#resumenText{
  white-space:pre-wrap;font-size:13px;color:#0f172a;margin-top:12px;
  border:1px dashed var(--borde);border-radius:10px;padding:10px 12px;
  background:#f8fafc;line-height:1.45;
}

/* ===== DETALLES ===== */
details summary{
  cursor:pointer;font-weight:700;color:#0b2c5f;
  margin-top:14px;
}
details[open] summary{color:#2563eb;}
details ul{margin-top:6px;font-size:13px;color:#334155;line-height:1.4;}

/* ===== PIE ===== */
footer{position:relative;left:50%;transform:translateX(-50%);
  width:100vw;margin:2rem 0 0 0;padding:1.5rem 0;
  border-top:1px solid #e5e7eb;background:#ffffff;
  text-align:center;box-shadow:0 -2px 6px rgba(0,0,0,0.04);}
/* Botón Volver inferior */
.back-btn{
  display:inline-block;
  margin:1.5rem auto 0;
  background:#0f3d83;
  color:#fff;
  text-decoration:none;
  font-weight:700;
  padding:0.7rem 1.4rem;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(15,61,131,.25);
  transition:background .2s, transform .1s, box-shadow .2s;
}
.back-btn:hover{
  background:#1c60c3;
  transform:translateY(-1px);
  box-shadow:0 6px 12px rgba(15,61,131,.35);
}
</style>
<style>
:root {
  --azul-institucional: #0f3d83;
}

/* Barra superior segura */
.safe-top {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: calc(env(safe-area-inset-top, 0px) + 28px);
  background: var(--azul-institucional);
  z-index: 1000;
}

/* Empuja el contenido real por debajo de la barra */
body {
  margin: 0;
  padding-top: calc(env(safe-area-inset-top, 0px) + 28px);
  background-color: #fff;
}
</style>

</head>
<body>
  <div class="safe-top"></div>
<header class="appbar" role="region" aria-label="Cabecera RoPE">
  <div class="appbar-inner">
    <div class="left-group">
      <h1>Escala RoPE</h1>
      <output id="pill" class="pill pill-init" aria-live="polite" aria-atomic="true">—</output>
    </div>
    <div class="actions">
      <a class="btn" href="../index.html">Inicio</a>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="panel">
    <p class="note">RoPE clásica (0–10 puntos). Estima la probabilidad de que el FOP sea causal del ictus.</p>

    <!-- Entradas -->
    <div class="grid">
      <div>
        <label for="age">Edad</label>
        <select id="age">
          <option value="">Selecciona…</option>
          <option value="5">≤ 30 años (+5)</option>
          <option value="4">31–40 años (+4)</option>
          <option value="3">41–50 años (+3)</option>
          <option value="2">51–60 años (+2)</option>
          <option value="1">61–70 años (+1)</option>
          <option value="0">&gt; 70 años (+0)</option>
        </select>
      </div>

      <div>
        <label>Factores clínicos (marcar si están AUSENTES)</label>
        <label class="check"><input type="checkbox" id="noHTN" value="1"> No hipertensión (+1)</label>
        <label class="check"><input type="checkbox" id="noDM" value="1"> No diabetes (+1)</label>
        <label class="check"><input type="checkbox" id="noSmoke" value="1"> No tabaquismo activo (+1)</label>
        <label class="check"><input type="checkbox" id="noPrior" value="1"> No ictus/AIT previo (+1)</label>
        <label class="check"><input type="checkbox" id="cortical" value="1"> Infarto cortical en neuroimagen (+1)</label>
      </div>
    </div>

    <!-- Resultados -->
    <div class="panel" id="resultCard" style="margin-top:16px; display:none;">
      <div class="kpi">
        <div class="box"><div class="ttl">RoPE</div><div class="val" id="scoreVal">-</div></div>
        <div class="box" id="probBox"><div class="ttl">Probabilidad FOP causal</div><div class="val" id="probVal">-</div></div>
      </div>

      <div class="kpi">
        <div class="box" id="classBox"><div class="ttl">Clasificación</div><div class="val" id="classVal">-</div></div>
        <div class="box"><div class="ttl">Interpretación</div><div class="val" id="interpVal" style="font-size:16px">-</div></div>
      </div>

      <div class="actions">
        <button id="btnClear" class="btn-action btn-clear">Borrar</button>
        <button id="btnCopy" class="btn-action btn-copy">Copiar resumen</button>
      </div>
      <div id="resumenText"></div>
    </div>

    <details>
      <summary>Abreviaturas y referencia</summary>
      <ul>
        <li><b>RoPE:</b> Risk of Paradoxical Embolism.</li>
        <li><b>FOP:</b> Foramen Oval Permeable.</li>
        <li><b>AIT:</b> Ataque Isquémico Transitorio.</li>
        <li><b>Referencia:</b> Kent DM et al. <em>Neurology</em>. 2013;81(7):619–625.</li>
      </ul>
    </details>
  </section>
<div style="text-align:center;">
  <a href="index.html" class="back-btn">Volver</a>
</div>
</main>

<script>
const PROB={0:'28%',1:'30%',2:'35%',3:'44%',4:'55%',5:'61%',6:'67%',7:'78%',8:'84%',9:'88%',10:'90%'};

function toneFor(score){
  if(score>=7) return 'bad';
  if(score>=4) return 'warn';
  return 'ok';
}
function labelFor(score){
  if(score>=7) return 'Alta';
  if(score>=4) return 'Intermedia';
  return 'Baja';
}
function interpFor(score){
  if(score>=7)  return 'Probabilidad alta: valorar cierre percutáneo del FOP (perfil típico: joven, sin FR y cortical).';
  if(score>=4)  return 'Probabilidad intermedia: discutir en sesión multidisciplinar beneficio-riesgo.';
  return 'Probabilidad baja: suele preferirse manejo médico (antiagregación) salvo otros hallazgos.';
}
const ids = ['age','noHTN','noDM','noSmoke','noPrior','cortical'];
const $ = id => document.getElementById(id);

function calc(){
  const age = $('age').value;
  if(age===''){
    $('resultCard').style.display='none';
    const pill=$('pill');
    pill.className='pill pill-init';
    pill.textContent='RoPE: —';
    return;
  }
  let s = parseInt(age,10);
  ['noHTN','noDM','noSmoke','noPrior','cortical'].forEach(id=>{
    if($(id).checked) s += parseInt($(id).value,10);
  });
  s = Math.max(0, Math.min(10, s));

  const prob = PROB[s] || '—';
  const cat  = labelFor(s);
  const tone = toneFor(s);

  $('scoreVal').textContent = s;
  $('probVal').textContent  = prob;
  $('classVal').textContent = cat;
  $('interpVal').textContent= interpFor(s);

  ['probBox','classBox'].forEach(id=>{
    const el=$(id); el.classList.remove('ok','warn','bad'); el.classList.add(tone);
  });

  $('resultCard').style.display='block';

  const pill=$('pill');
  pill.className='pill pill-'+tone;
  pill.textContent = `RoPE: ${s} — ${prob} (${cat})`;

  mostrarResumen(s, prob, cat);
}

function mostrarResumen(s, prob, cat){
  let t = 'Escala RoPE (Risk of Paradoxical Embolism)\n';
  t += '========================================\n';
  t += `Puntuación: ${s}/10\nProbabilidad FOP causal: ${prob} (${cat})\n\nDetalle de variables:\n`;

  const ageText = $('age').options[$('age').selectedIndex].textContent;
  t += `- Edad: ${ageText}\n`;
  [
    ['noHTN','No hipertensión (+1)'],
    ['noDM','No diabetes (+1)'],
    ['noSmoke','No tabaquismo activo (+1)'],
    ['noPrior','No ictus/AIT previo (+1)'],
    ['cortical','Infarto cortical (+1)']
  ].forEach(([id,label])=>{
    t += `- ${label}: ${$(id).checked ? 'Sí' : 'No'}\n`;
  });

  t += `\nInterpretación: ${interpFor(s)}`;
  $('resumenText').textContent = t;
}

function borrar(){
  $('age').value='';
  ['noHTN','noDM','noSmoke','noPrior','cortical'].forEach(id=>$(id).checked=false);
  $('resultCard').style.display='none';
  const pill=$('pill'); pill.className='pill pill-init'; pill.textContent='RoPE: —';
  $('resumenText').textContent='';
}

function copiar(){
  const t = $('resumenText').textContent.trim();
  if(!t) return;
  navigator.clipboard.writeText(t).then(()=>{
    const b=$('btnCopy');
    b.classList.add('copiado'); b.textContent='Copiado';
    setTimeout(()=>{b.classList.remove('copiado'); b.textContent='Copiar resumen';}, 1500);
  });
}

ids.forEach(id=>{
  const el=$(id);
  if(el) el.addEventListener(el.type==='select-one'?'change':'input', calc);
});
document.getElementById('btnClear')?.addEventListener('click', borrar);
document.getElementById('btnCopy')?.addEventListener('click', copiar);
</script>

<footer>
  <img src="uibanner.png" alt="Unidad de Ictus Málaga" style="max-width:380px;height:auto;opacity:.96;">
</footer>
<script src="js/index.js"></script>
</body>
</html>
